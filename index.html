<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Day Trade Discipline Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 20px;
}
.card {
  background: #fff;
  max-width: 600px;
  margin: auto;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h2 { margin-top: 0; }
input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover { background: #0056b3; }
.pass { color: green; font-weight: bold; }
.fail { color: red; font-weight: bold; }
.score {
  font-size: 26px;
  font-weight: bold;
}
.small {
  font-size: 12px;
  color: gray;
  margin-top: 15px;
}
</style>
</head>

<body>

<div class="card">
<h2>ğŸ“ˆ Day Trade Discipline Analyzer</h2>

<p>
Evaluates whether a stock has a <b>repeatable open â†’ high edge</b><br>
based on the last 20 trading days.
</p>

<input id="ticker" placeholder="US Stock (AAPL, TSLA, NVDA)">
<input id="target" type="number" value="2" step="0.5">

<button onclick="analyze()">Analyze</button>

<div id="output"></div>

<div class="small">
Statistics only. No prediction. Not financial advice.
</div>
</div>

<script>
async function analyze(){
  const ticker = document.getElementById("ticker").value.trim().toLowerCase();
  const targetPct = parseFloat(document.getElementById("target").value) / 100;
  const out = document.getElementById("output");

  if(!ticker){
    alert("Enter ticker");
    return;
  }

  out.innerHTML = "â³ Loading historical data...";

  try {
    const rawURL = `https://stooq.com/q/d/l/?s=${ticker}.us&i=d`;
    const url = `https://api.allorigins.win/raw?url=${encodeURIComponent(rawURL)}`;

    const res = await fetch(url);
    const csv = await res.text();

    if(!csv || !csv.includes(",")){
      out.innerHTML = "âŒ Data source returned invalid response.";
      return;
    }

    const lines = csv.trim().split("\n");
    if(lines.length < 30){
      out.innerHTML = "âŒ Not enough historical data.";
      return;
    }

    let rows = lines.slice(1).map(l => {
      const p = l.split(",");
      if(p.length < 6) return null;

      const open = parseFloat(p[1]);
      const high = parseFloat(p[2]);
      const volume = parseFloat(p[5]);

      if(!open || !high || !volume) return null;
      return { open, high, volume };
    }).filter(Boolean);

    if(rows.length < 20){
      out.innerHTML = "âŒ Insufficient valid trading days.";
      return;
    }

    rows = rows.slice(-20);

    let wins = 0;
    let gains = [];
    let vols = [];
    let winVols = [];

    rows.forEach(r => {
      const gain = (r.high - r.open) / r.open;
      gains.push(gain);
      vols.push(r.volume);
      if(gain >= targetPct){
        wins++;
        winVols.push(r.volume);
      }
    });

    const avgGain = gains.reduce((a,b)=>a+b,0)/gains.length*100;
    const avgVol = vols.reduce((a,b)=>a+b,0)/vols.length;
    const avgWinVol = winVols.length
      ? winVols.reduce((a,b)=>a+b,0)/winVols.length
      : 0;

    // -------- SCORING ----------
    let score = 0;

    score += Math.min(wins * 4, 40);              // consistency
    score += Math.min(avgGain * 5, 25);           // range
    score += avgWinVol >= avgVol * 0.8 ? 20 : 0;  // volume confirmation
    score += avgVol > 1_000_000 ? 15 : 5;          // liquidity

    score = Math.round(Math.min(score, 100));

    const pass =
      score >= 70 && wins >= 10;

    out.innerHTML = `
    <hr>

    <b>${ticker.toUpperCase()}</b><br><br>

    ğŸ¯ Target move: ${(targetPct*100).toFixed(1)}%<br>
    âœ… Win days: ${wins}/20<br>
    ğŸ“ˆ Avg intraday gain: ${avgGain.toFixed(2)}%<br><br>

    ğŸ“Š Avg volume: ${Math.round(avgVol).toLocaleString()}<br>
    ğŸ“Š Win-day volume: ${Math.round(avgWinVol).toLocaleString()}<br><br>

    <div class="score">Score: ${score}/100</div><br>

    <span class="${pass?'pass':'fail'}">
    ${pass
      ? "âœ… Consistent intraday edge (open â†’ high)"
      : "âŒ Edge not stable or volume weak"}
    </span>
    `;
  }
  catch(e){
    console.error(e);
    out.innerHTML = "âŒ Network or symbol error.";
  }
}
</script>
</body>
</html>
