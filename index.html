<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Intraday Opportunity Analyzer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}
.card {
  background: #ffffff;
  padding: 20px;
  max-width: 520px;
  margin: auto;
  border-radius: 8px;
  box-shadow: 0 0 6px rgba(0,0,0,0.1);
}
input, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover {
  background: #0056b3;
}
.pass { color: green; font-weight: bold; }
.fail { color: red; font-weight: bold; }
.small {
  font-size: 12px;
  color: gray;
  margin-top: 15px;
}
</style>
</head>

<body>
<div class="card">
  <h2>Intraday Price & Volume Analyzer</h2>
  <p>Historical Open → High opportunity (20 days)</p>

  <input id="ticker" placeholder="US Ticker (AAPL, TSLA)">
  <input id="target" type="number" value="2" step="0.5">

  <button onclick="analyze()">Analyze</button>

  <div id="output"></div>

  <div class="small">
    Statistics only. Not investment advice.
  </div>
</div>

<script>
async function analyze(){
  const ticker = document.getElementById("ticker").value.trim().toLowerCase();
  const targetPct = parseFloat(document.getElementById("target").value) / 100;
  const out = document.getElementById("output");

  if(!ticker){
    alert("Enter ticker");
    return;
  }

  out.innerHTML = "⏳ Loading data...";

  try {
    const stooqURL =
      `https://stooq.com/q/d/l/?s=${ticker}.us&i=d`;

    const proxyURL =
      `https://api.allorigins.win/raw?url=${encodeURIComponent(stooqURL)}`;

    const res = await fetch(proxyURL);
    const csv = await res.text();

    if(!csv || csv.includes("404")){
      throw "CSV empty";
    }

    const lines = csv.trim().split("\n");
    if(lines.length < 25){
      out.innerHTML = "❌ Not enough data.";
      return;
    }

    let rows = lines.slice(1).map(line => {
      const [date, open, high, low, close, volume] = line.split(",");
      return {
        open: parseFloat(open),
        high: parseFloat(high),
        volume: parseFloat(volume)
      };
    }).filter(r => r.open && r.high && r.volume);

    rows = rows.slice(-20);

    let wins = [];
    let gains = [];
    let vols = [];

    rows.forEach(r => {
      const gain = (r.high - r.open) / r.open;
      gains.push(gain);
      vols.push(r.volume);
      if(gain >= targetPct) wins.push(r);
    });

    const avgGain = gains.reduce((a,b)=>a+b,0)/gains.length*100;
    const avgVol = vols.reduce((a,b)=>a+b,0)/vols.length;
    const avgWinVol = wins.length
      ? wins.reduce((a,b)=>a+b.volume,0)/wins.length
      : 0;

    const lowVolWins = wins.filter(
      d => d.volume < avgVol * 0.5
    ).length;

    const pricePass = wins.length >= 10;
    const volumePass =
      avgWinVol >= avgVol * 0.8 &&
      lowVolWins <= wins.length * 0.3;

    const finalPass = pricePass && volumePass;

    out.innerHTML = `
      <hr>
      <b>${ticker.toUpperCase()}</b><br><br>

      ≥ ${(targetPct*100).toFixed(1)}% days: ${wins.length}/${rows.length}<br>
      Avg intraday gain: ${avgGain.toFixed(2)}%<br><br>

      Avg volume (20d): ${Math.round(avgVol).toLocaleString()}<br>
      Avg volume on win days: ${Math.round(avgWinVol).toLocaleString()}<br><br>

      <span class="${finalPass ? 'pass':'fail'}">
      ${finalPass
        ? '✅ Consistent intraday opportunity + volume support'
        : '❌ Not stable or low participation'}
      </span>
    `;

  } catch (e) {
    console.error(e);
    out.innerHTML = "❌ Data fetch failed. Try another ticker.";
  }
}
</script>
</body>
</html>
